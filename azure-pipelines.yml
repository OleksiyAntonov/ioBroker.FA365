trigger:
- master

stages:
- stage: stageCompilePackage
  displayName: 'Compile and publish package'
  jobs:
  - job: jobProcessingContent
    displayName: 'Processing iobroker.homebrain content'
    pool:
      name: Default
    steps:
    - task: GitVersion@5
      inputs:
        runtime: 'core'
    - task: Npm@1
      inputs:
        command: 'install'
        workingDir: '$(Build.Repository.LocalPath)'
        customRegistry: 'useFeed'
        customFeed: '0141a56e-c2c5-4ed4-86a0-84ff0ab12256'
    - task: Npm@1
      inputs:
        command: 'custom'
        customCommand: 'version $(GitVersion.FullSemVer) --no-git-tag-version'
        customRegistry: 'useFeed'
        customFeed: '0141a56e-c2c5-4ed4-86a0-84ff0ab12256'
    - task: Npm@1
      inputs:
        command: 'publish'
        workingDir: '$(Build.Repository.LocalPath)'
        publishRegistry: 'useFeed'
        publishFeed: 'b15b30a9-c1af-485f-acfd-d136c361288a/0fb21e05-dfe2-4b7a-98fd-c2d899e2dc1c'
